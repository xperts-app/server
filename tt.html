<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        :root {
            --primary-blue: #0066ff;
            --background-color: #f0f4f9;
        }

        body {
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            height: 100vh;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 102, 255, 0.2);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="spinner"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk",
            authDomain: "xperts-data.firebaseapp.com",
            projectId: "xperts-data",
            storageBucket: "xperts-data.firebasestorage.app",
            messagingSenderId: "934675149024",
            appId: "1:934675149024:web:23486a5f38f65f103ce085"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Class to URL mapping
        const classUrlMap = {
            6: "https://abc.xyz/6",
            7: "https://abc.xyz/7",
            8: "https://abc.xyz/8",
            9: "https://abc.xyz/9",
            10: "https://abc.xyz/10",
            "11 NEET": "https://abc.xyz/N11",
            "11 JEE": "https://abc.xyz/J11",
            "12 NEET": "https://abc.xyz/N12",
            "12 JEE": "https://abc.xyz/J12"
        };

        document.addEventListener("DOMContentLoaded", async () => {
            const userId = localStorage.getItem("loggedInUserId");

            // No user ID → redirect to login page
            if (!userId) {
                window.location.href = "1.html";
                return;
            }

            try {
                const userDoc = await db.collection("users").doc(userId).get();

                if (!userDoc.exists) {
                    throw new Error("User not found");
                }

                const { class: userClass, goal, role } = userDoc.data();

                // Not a student → redirect
                if (role !== "Student") {
                    window.location.href = "4.html";
                    return;
                }

                // Missing class in profile
                if (!userClass) {
                    throw new Error("Profile incomplete: class not found");
                }

                // Build key for mapping
                let mapKey = userClass;
                if (goal === "NEET" || goal === "JEE") {
                    mapKey = `${userClass}-${goal}`;
                } else {
                    userClass.toString().replace("th", "");
                }

                const targetUrl = classUrlMap[mapKey];

                // No matching URL
                if (!targetUrl) {
                    throw new Error(`Configuration Error: No URL for key "${mapKey}"`);
                }

                // Redirect to mapped URL
                window.location.replace(targetUrl);

            } catch (err) {
                console.error("Redirect failed:", err);
                alert("Could not redirect you. " + err.message);
                window.location.href = "4.html";
            }
        });
    </script>
</body>
</html>
