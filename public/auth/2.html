<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Your Experience - ALLEN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; background-color: #f0f4f9; margin: 0; padding-top: 50px; }
        .main-container { max-width: 450px; margin: auto; padding: 20px; }
        .progress-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 5px; margin-bottom: 40px; }
        .progress-bar { width: 20%; height: 6px; background-color: #007bff; border-radius: 5px; transition: width 0.4s ease-in-out; }
        .step { display: none; text-align: center; }
        .step.active { display: block; }
        .illustration { width: 150px; height: 150px; margin: 0 auto 30px auto; }
        h2 { font-weight: 600; font-size: 24px; color: #1d2c3c; margin-bottom: 8px; }
        p { color: #5a6b7d; font-size: 16px; margin-bottom: 30px; }
        .text-input { width: 100%; padding: 15px; border: 1px solid #ccc; border-radius: 12px; font-size: 16px; margin-bottom: 20px; box-sizing: border-box; }
        .btn-primary { background-color: #007bff; color: white; border: none; padding: 15px 0; border-radius: 12px; font-size: 18px; font-weight: 600; width: 100%; cursor: pointer; transition: background-color 0.3s; }
        .btn-primary:disabled { background-color: #a0cffd; cursor: not-allowed; }
        .selection-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .selection-btn { background-color: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 20px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .selection-btn.selected { border-color: #007bff; background-color: #e7f1ff; color: #007bff; }
        .back-arrow { position: absolute; top: 20px; left: 20px; width: 40px; height: 40px; background-color: #e0e0e0; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 20px; color: #333; text-decoration: none; }
    </style>
</head>
<body>
    <a href="#" id="back-btn" class="back-arrow" style="display: none;">‚Üê</a>
    <div class="main-container">
        <div class="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div>
        <form id="signup-form">
            <!-- Step 1-2 remain the same -->
            <div class="step active" data-step="1">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="45" fill="#e0f7fa"/><path d="M50 25 C65 25 68 35 68 45 C68 60 50 80 50 80 C50 80 32 60 32 45 C32 35 35 25 50 25 Z" fill="#ffcc80"/><path d="M40 20 L60 20 L70 30 L30 30 Z" fill="#3949ab"/><rect x="47" y="78" width="6" height="10" fill="#424242" /></svg>
                <h2>We are excited to have you join the MCI family!</h2><p>What should we call you?</p>
                <input type="text" id="fullName" class="text-input" placeholder="Student's full name" required><button type="button" class="btn-primary" onclick="nextStep()">Next</button>
            </div>
            <div class="step" data-step="2">
                 <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="75" width="50" height="10" rx="3" fill="#1e88e5"/><rect x="35" y="65" width="30" height="10" fill="#42a5f5"/><rect x="45" y="40" width="10" height="25" fill="#1565c0"/><circle cx="50" cy="30" r="12" fill="#ffc107"/><path d="M 50 18 A 12 12 0 0 0 50 42" fill="#ffca28"/><path d="M65 80 L60 75 L60 60 L70 55 L75 60 L75 75 Z" fill="#43a047"/><path d="M63 78 L77 78 L77 75 L63 75Z" fill="#e8f5e9"/></svg>
                <h2 id="greeting-name">Hi, [Name]!</h2><p>Xperts can help you prepare better! Please tell us your goal.</p>
                <div class="selection-grid" id="goal-selection" style="grid-template-columns: repeat(3, 1fr);">
                    <button type="button" class="selection-btn" data-value="NEET">NEET</button><button type="button" class="selection-btn" data-value="JEE">JEE</button><button type="button" class="selection-btn" data-value="Class 6-10">Class 6-10</button>
                </div>
            </div>
            <div class="step" data-step="3">
                 <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="75" width="50" height="10" rx="3" fill="#1e88e5"/><rect x="35" y="65" width="30" height="10" fill="#42a5f5"/><rect x="45" y="40" width="10" height="25" fill="#1565c0"/><circle cx="50" cy="30" r="12" fill="#ffc107"/><path d="M 50 18 A 12 12 0 0 0 50 42" fill="#ffca28"/><path d="M65 80 L60 75 L60 60 L70 55 L75 60 L75 75 Z" fill="#43a047"/><path d="M63 78 L77 78 L77 75 L63 75Z" fill="#e8f5e9"/></svg>
                <h2 id="class-heading">You selected, [Goal]!</h2><p id="class-subheading">[Achievements Text]</p>
                <div class="selection-grid" id="class-selection"></div>
            </div>
            <div class="step" data-step="4">
                 <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="75" width="50" height="10" rx="3" fill="#1e88e5"/><rect x="35" y="65" width="30" height="10" fill="#42a5f5"/><rect x="45" y="40" width="10" height="25" fill="#1565c0"/><circle cx="50" cy="30" r="12" fill="#ffc107"/><path d="M 50 18 A 12 12 0 0 0 50 42" fill="#ffca28"/><path d="M65 80 L60 75 L60 60 L70 55 L75 60 L75 75 Z" fill="#43a047"/><path d="M63 78 L77 78 L77 75 L63 75Z" fill="#e8f5e9"/></svg>
                <h2>Select your Board</h2><p>This helps us tailor your learning plan.</p>
                <div class="selection-grid" id="board-selection">
                    <button type="button" class="selection-btn" data-value="CBSE">CBSE</button><button type="button" class="selection-btn" data-value="ICSE">ICSE</button><button type="button" class="selection-btn" data-value="State Board">State Board</button><button type="button" class="selection-btn" data-value="Others">Others</button>
                </div>
            </div>
            <div class="step" data-step="5">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M85,40H70V25c0-13.8-11.2-25-25-25S20,11.2,20,25v15H5c-2.8,0-5,2.2-5,5v50c0,2.8,2.2,5,5,5h80c2.8,0,5-2.2,5-5V45 C90,42.2,87.8,40,85,40z M25,25c0-11,9-20,20-20s20,9,20,20v15H25V25z" fill="#0288d1"/><path d="M5,95h80c2.8,0,5-2.2,5-5V45c0-2.8-2.2-5-5-5H5c-2.8,0-5,2.2-5,5v45C0,92.8,2.2,95,5,95z" fill="#03a9f4"/></svg>
                <h2>Just a few more details</h2><p>Please provide the following information.</p>
                <input type="text" id="parentName" class="text-input" placeholder="Parent's Name" required><input type="text" id="dob" class="text-input" placeholder="Date of Birth" onfocus="(this.type='date')" onblur="(this.type='text')" required><input type="email" id="email" class="text-input" placeholder="Email ID" required><input type="password" id="password" class="text-input" placeholder="Create a Password" required>
                <button type="button" class="btn-primary" id="final-submit-btn">Let's Go!</button>
            </div>
            <div class="step" data-step="6">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path fill="#4caf50" d="M49.8,5.8C25.5,5.8,5.8,25.5,5.8,49.8s19.7,44,44,44s44-19.7,44-44S74.1,5.8,49.8,5.8z M49.8,88.8 C28.6,88.8,10.8,71,10.8,49.8S28.6,10.8,49.8,10.8S88.8,28.6,88.8,49.8S71,88.8,49.8,88.8z"/><path fill="#4caf50" d="M43.1,68.8L26.3,52l4.9-4.9l11.9,11.9l24.7-24.7l4.9,4.9L43.1,68.8z"/></svg>
                <h2>Thank you for sharing your details!</h2><p>Your account has been created. An administrator will review your profile for activation. You will be redirected shortly.</p>
            </div>
        </form>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk", authDomain: "xperts-data.firebaseapp.com", projectId: "xperts-data", storageBucket: "xperts-data.firebasestorage.app", messagingSenderId: "934675149024", appId: "1:934675149024:web:23486a5f38f65f103ce085", measurementId: "G-6TS06NTDZQ" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentStep = 1; const totalSteps = 5; const formData = { mobileNumber: localStorage.getItem('mobileForSignup') };
        const backBtn = document.getElementById('back-btn'); const progressBar = document.getElementById('progress-bar');
        document.addEventListener('DOMContentLoaded', () => { if (!formData.mobileNumber) { alert("Mobile number not found. Redirecting to login."); window.location.href = '1.html'; } });
        function showStep(step) { document.querySelectorAll('.step').forEach(s => s.classList.remove('active')); const activeStep = document.querySelector(`.step[data-step="${step}"]`); if(activeStep) activeStep.classList.add('active'); progressBar.style.width = `${(step / (totalSteps + 1)) * 100}%`; backBtn.style.display = step > 1 && step <= totalSteps ? 'flex' : 'none'; }
        function nextStep() { if (currentStep === 1) { const fullName = document.getElementById('fullName').value; if (!fullName.trim()) { alert('Please enter your full name.'); return; } formData.fullName = fullName; document.getElementById('greeting-name').textContent = `Hi, ${fullName.split(' ')[0]}!`; } currentStep++; showStep(currentStep); }
        function prevStep() { if (currentStep > 1) { currentStep--; showStep(currentStep); } }
        backBtn.addEventListener('click', (e) => { e.preventDefault(); prevStep(); });
        document.querySelectorAll('.selection-btn').forEach(btn => { btn.addEventListener('click', () => { const parent = btn.parentElement; parent.querySelectorAll('.selection-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); const key = parent.id.split('-')[0]; formData[key] = btn.dataset.value; if (key === 'goal') { updateClassOptions(formData.goal); } setTimeout(nextStep, 200); }); });
        function updateClassOptions(goal) {
            const classSelection = document.getElementById('class-selection'); const classHeading = document.getElementById('class-heading'); const classSubheading = document.getElementById('class-subheading'); classSelection.innerHTML = ''; let classes = [];
            classHeading.textContent = `You selected, ${goal}!`;
            if (goal === 'NEET' || goal === 'JEE') { classes = [{val: "11", text: "11th"}, {val: "12", text: "12th"}]; classSubheading.textContent = goal === 'NEET' ? '1 lakh+ qualifications in NEET UG 2023' : 'Top ranks in JEE Advanced'; classSelection.style.gridTemplateColumns = 'repeat(2, 1fr)'; } 
            else if (goal === 'Class 6-10') { classes = [{val: "6", text: "6th"}, {val: "7", text: "7th"}, {val: "8", text: "8th"}, {val: "9", text: "9th"}, {val: "10", text: "10th"}]; classSubheading.textContent = '36 medals won in International Olympiads'; classSelection.style.gridTemplateColumns = 'repeat(3, 1fr)'; }
            classes.forEach(c => { const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'selection-btn'; btn.dataset.value = c.val; btn.textContent = c.text; btn.addEventListener('click', () => { document.querySelectorAll('#class-selection .selection-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); formData.class = c.val; setTimeout(nextStep, 200); }); classSelection.appendChild(btn); });
        }
        document.getElementById('final-submit-btn').addEventListener('click', async () => {
            formData.parentName = document.getElementById('parentName').value.trim(); formData.dob = document.getElementById('dob').value; formData.email = document.getElementById('email').value.trim(); formData.password = document.getElementById('password').value;
            if (!formData.parentName || !formData.dob || !formData.email || !formData.password) { alert('Please fill all the required fields.'); return; }
            
            // --- MODIFICATION START ---
            // Create the new combined class value to be stored in Firestore
            const dataToSave = { ...formData }; // Create a copy to avoid changing formData
            if (dataToSave.goal === 'NEET' || dataToSave.goal === 'JEE') {
                // If goal is NEET/JEE, combine class and goal. E.g., "11" + " " + "NEET" -> "11 NEET"
                dataToSave.class = `${dataToSave.class} ${dataToSave.goal}`;
            }
            // For "Class 6-10", dataToSave.class is already correct (e.g., "6", "7", etc.)
            // --- MODIFICATION END ---
            
            dataToSave.role = 'Student'; dataToSave.isAllowed = false;
            const submitBtn = document.getElementById('final-submit-btn'); submitBtn.disabled = true; submitBtn.textContent = 'Saving...';
            try {
                // Use the modified 'dataToSave' object
                await db.collection('users').add(dataToSave);
                localStorage.removeItem('mobileForSignup'); currentStep++; showStep(currentStep);
                setTimeout(() => { window.location.href = 'https://nokia.com'; }, 4000);
            } catch (error) { console.error("Error adding document: ", error); alert('There was an error creating your account. Please try again.'); submitBtn.disabled = false; submitBtn.textContent = 'Let\'s Go!'; }
        });
    </script>
</body>
</html>
